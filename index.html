<!-- === Top-Down Shooter (single-file) ===
     Save this as: topdown_shooter.html
     Open in any modern browser. Have fun! Hewwo :3 üéÆ
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Arcade Bite ‚Äî Top-Down Shooter</title>
  <style>
    /* === Styles: clean, minimal HUD and layout === */
    html,body{height:100%;margin:0;background:#111;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:#eee}
    #gameWrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
    canvas{background:linear-gradient(#0b0b0f,#07111a);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.6);}

    /* HUD overlay */
    .hud{position:absolute;left:20px;top:20px;color:#fff;font-weight:600;text-shadow:0 2px 6px rgba(0,0,0,.7)}
    .hud .row{margin-bottom:8px}
    .money{font-size:18px}
    .wave{font-size:14px;opacity:.9}

    /* Right-side panel */
    .panel{position:absolute;right:20px;top:20px;width:260px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.04);padding:12px;border-radius:10px}
    .panel h3{margin:0 0 8px 0;font-size:15px}
    .panel button{display:block;width:100%;padding:8px;margin:6px 0;border-radius:8px;border:0;background:#1c1f2a;color:#fff;cursor:pointer;font-weight:700}
    .panel .small{font-size:12px;opacity:.9}

    /* Shop overlay */
    #shop{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#0f1318;border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,.04);width:520px;max-width:96%;display:none;z-index:20}
    #shop h2{margin:0 0 10px;color:#ffd15a}
    .upgrade{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;margin:6px 0;background:linear-gradient(90deg,rgba(255,255,255,.015),transparent)}
    .upgrade .meta{max-width:68%}
    .upgrade button{padding:8px 12px;border-radius:8px;border:0;background:#2a6eff;color:#fff;cursor:pointer}

    #footerTips{position:fixed;left:50%;transform:translateX(-50%);bottom:14px;color:#bbb;font-size:13px}

    /* small screen tweaks */
    @media (max-width:640px){.panel{display:none}} 
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="c" width="1000" height="700"></canvas>

    <div class="hud" id="hudLeft">
      <div class="row money">üí∞ <span id="money">0</span></div>
      <div class="row wave">Wave: <span id="wave">0</span> &nbsp; | &nbsp; Kills: <span id="kills">0</span></div>
      <div class="row">‚ù§ <span id="hp">100</span> / <span id="maxHp">100</span></div>
    </div>

    <div class="panel">
      <h3>Controls</h3>
      <div class="small">W A D to move ‚Ä¢ Down Arrow (‚Üì) to move down ‚Ä¢ Mouse to aim ‚Ä¢ Left click to shoot ‚Ä¢ Hold to autofire ‚Ä¢ <strong>S</strong> to open shop ‚Ä¢ P to pause</div>
      <h3 style="margin-top:12px">Stats</h3>
      <div class="small">Damage: <span id="statDamage">1</span> ‚Ä¢ Fire Rate: <span id="statFR">3</span>/s ‚Ä¢ Speed: <span id="statSpeed">3.0</span></div>
      <button id="btnShop">Open Shop (S)</button>
      <button id="btnRestart" style="background:#ff6b6b;margin-top:8px">Restart Game</button>
    </div>

  </div>

  <div id="shop">
    <h2>Upgrade Shop ‚ú®</h2>
    <div class="upgrade"><div class="meta"><strong>Damage</strong><div class="small">Increase bullet damage (+1)</div></div><div><button data-action="buy" data-type="damage">Buy ‚Äî <span class="cost">50</span></button></div></div>
    <div class="upgrade"><div class="meta"><strong>Fire Rate</strong><div class="small">Shoot more bullets per second (+0.5/s)</div></div><div><button data-action="buy" data-type="firerate">Buy ‚Äî <span class="cost">60</span></button></div></div>
    <div class="upgrade"><div class="meta"><strong>Speed</strong><div class="small">Move faster (+0.4)</div></div><div><button data-action="buy" data-type="speed">Buy ‚Äî <span class="cost">70</span></button></div></div>
    <div class="upgrade"><div class="meta"><strong>Max HP</strong><div class="small">Increase max HP (+15)</div></div><div><button data-action="buy" data-type="maxhp">Buy ‚Äî <span class="cost">80</span></button></div></div>
    <div class="upgrade"><div class="meta"><strong>Bullet Speed</strong><div class="small">Bullets travel faster (+1)</div></div><div><button data-action="buy" data-type="bulletspeed">Buy ‚Äî <span class="cost">40</span></button></div></div>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="closeShop" style="flex:1;background:#6bffb1;color:#000;font-weight:800">Close</button>
      <button id="upgradeAll" style="flex:1;background:#ffd15a;color:#000;font-weight:800">Auto-Select (Best Value)</button>
    </div>
  </div>

  <div id="footerTips">Tip: Survive waves to earn more money ‚Äî defeat big enemies for huge payouts! üåü</div>

  <script>
    // === JavaScript Game: Arcade Bite ===
    (()=>{
      // Helpers
      const rand = (a,b)=>Math.random()*(b-a)+a;
      const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

      // Canvas & context
      const canvas = document.getElementById('c');
      const ctx = canvas.getContext('2d');
      function resize(){
        const scale = Math.min(window.innerWidth-40,1200);
        canvas.width = Math.min(1200, window.innerWidth - 40);
        canvas.height = Math.min(800, window.innerHeight - 120);
      }
      window.addEventListener('resize',resize); resize();

      // Game state
      let running = true;
      let paused = false;
      let lastTime = 0;
      let mouse = {x:canvas.width/2,y:canvas.height/2,down:false};
      let keys = {};

      // HUD elements
      const moneyEl = document.getElementById('money');
      const waveEl = document.getElementById('wave');
      const killsEl = document.getElementById('kills');
      const hpEl = document.getElementById('hp');
      const maxHpEl = document.getElementById('maxHp');
      const statDamage = document.getElementById('statDamage');
      const statFR = document.getElementById('statFR');
      const statSpeed = document.getElementById('statSpeed');

      // Audio simple beeps
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      function beep(freq, duration=0.06, volume=0.03){
        try{
          const o = audioCtx.createOscillator();
          const g = audioCtx.createGain();
          o.type = 'sine'; o.frequency.value = freq;
          g.gain.value = volume;
          o.connect(g); g.connect(audioCtx.destination);
          o.start();
          o.stop(audioCtx.currentTime + duration);
        }catch(e){}
      }

      // Player
      const player = {
        x:canvas.width/2, y:canvas.height/2, r:14,
        speed:3, maxHp:100, hp:100,
        damage:4, fireRate:3, bulletSpeed:8,
        money:0, score:0, kills:0,
        cooldown:0
      };

      // Arrays
      let bullets = [];
      let enemies = [];
      let particles = [];
      let coins = [];

      // Wave manager
      let wave = 0;
      let waveTimer = 0;
      let spawning = false;
      let spawnCount = 0;

      // Controls
      canvas.addEventListener('mousemove',e=>{
        const rect = canvas.getBoundingClientRect();
        mouse.x = (e.clientX - rect.left) * (canvas.width / rect.width);
        mouse.y = (e.clientY - rect.top) * (canvas.height / rect.height);
      });
      canvas.addEventListener('mousedown',e=>{mouse.down=true; audioCtx.resume();});
      window.addEventListener('mouseup',e=>mouse.down=false);

      // === Key handling: S opens shop, Down Arrow moves down ===
      window.addEventListener('keydown',e=>{
        const k = (e.key || '').toLowerCase();

        // S key toggles the shop (do not register 's' as movement anymore)
        if(k === 's'){
          toggleShop();
          return;
        }

        // Pause
        if(k === 'p'){
          paused = !paused;
          return;
        }

        // Movement keys we track in `keys`
        // Note: down movement is now ArrowDown (key 'arrowdown')
        if(['w','a','d','arrowdown','arrowleft','arrowright','arrowup'].includes(k)){
          keys[k] = true;
        }
      });

      window.addEventListener('keyup',e=>{
        const k = (e.key || '').toLowerCase();
        if(['w','a','d','arrowdown','arrowleft','arrowright','arrowup'].includes(k)){
          keys[k] = false;
        }
      });

      // Shop UI
      const shop = document.getElementById('shop');
      document.getElementById('btnShop').addEventListener('click',toggleShop);
      document.getElementById('closeShop').addEventListener('click',toggleShop);
      document.getElementById('btnRestart').addEventListener('click',()=>{location.reload()});
      document.getElementById('upgradeAll').addEventListener('click',()=>{autoBuy()});

      function toggleShop(){
        if(shop.style.display==='block'){shop.style.display='none';paused=false;}else{shop.style.display='block';paused=true;}
      }

      // Shop buy handling
      shop.addEventListener('click',e=>{
        const b = e.target.closest('button[data-action]');
        if(!b) return;
        const type = b.dataset.type;
        const costEl = b.querySelector('.cost') || b.querySelector('span.cost');
        const cost = Number(costEl ? costEl.textContent : b.getAttribute('data-cost'));
        buyUpgrade(type,cost,b);
      });

      function buyUpgrade(type,cost,btn){
        if(player.money < cost) return; player.money -= cost; beep(900,0.05,0.03);
        // scale costs in DOM
        if(type==='damage'){player.damage += 1; increaseCost(btn,1.5)}
        if(type==='firerate'){player.fireRate += 0.5; increaseCost(btn,1.6)}
        if(type==='speed'){player.speed += 0.4; increaseCost(btn,1.5)}
        if(type==='maxhp'){player.maxHp += 15; player.hp += 15; increaseCost(btn,1.7)}
        if(type==='bulletspeed'){player.bulletSpeed += 1; increaseCost(btn,1.4)}
        updateHUD();
      }
      function increaseCost(btn,mul){
        const span = btn.querySelector('.cost');
        const now = Number(span.textContent);
        span.textContent = Math.round(now * mul);
      }
      function autoBuy(){
        // simple greedy pick: buy cheapest affordable repeatedly
        let bought = true; while(bought){
          const all = Array.from(shop.querySelectorAll('button[data-action]')).map(b=>({btn:b,cost:Number(b.querySelector('.cost').textContent),type:b.dataset.type})).sort((a,b)=>a.cost-b.cost);
          bought=false;
          for(const item of all){ if(player.money>=item.cost){ buyUpgrade(item.type,item.cost,item.btn); bought=true; break;} }
        }
      }

      // Spawn helpers
      function spawnEnemy(type,x,y){
        const base = {x:x,y:y,angle:0,r:12,spd:1.4,hp:8,maxHp:8,color:'#ff6b6b',value:8};
        if(type==='brute'){ base.r=18; base.spd=0.9; base.hp=30; base.maxHp=30; base.color='#ffb86b'; base.value=35 }
        if(type==='fast'){ base.r=10; base.spd=2.2; base.hp=10; base.maxHp=10; base.color='#7ae7ff'; base.value=10 }
        if(type==='tank'){ base.r=26; base.spd=0.6; base.hp=60; base.maxHp=60; base.color='#8d6bff'; base.value=80 }
        enemies.push(base);
      }

      function startWave(){
        wave++;
        waveTimer = 0; spawning = true;
        spawnCount = 4 + wave*2;
        waveEl.textContent = wave;
        // spawn a few immediate enemies and schedule more
        for(let i=0;i<Math.min(3,spawnCount);i++) spawnFromEdge();
      }

      function spawnFromEdge(){
        const edge = Math.floor(rand(0,4));
        let x=0,y=0;
        if(edge===0){ x = rand(-50, canvas.width+50); y = -40 }
        if(edge===1){ x = rand(-50, canvas.width+50); y = canvas.height+40 }
        if(edge===2){ x = -40; y = rand(-50, canvas.height+50) }
        if(edge===3){ x = canvas.width+40; y = rand(-50, canvas.height+50) }
        // pick type based on wave
        const r = Math.random();
        if(wave % 7 === 0 && Math.random()<0.5) spawnEnemy('tank',x,y);
        else if(r<0.2) spawnEnemy('brute',x,y);
        else if(r<0.5) spawnEnemy('fast',x,y);
        else spawnEnemy('basic',x,y);
      }

      // Game loop
      function update(dt){
        if(paused) return;
        // player input
        let dx=0,dy=0;
        if(keys['w']) dy -= 1;
        // 's' no longer used for movement ‚Äî down movement now uses ArrowDown
        if(keys['arrowdown']) dy += 1;
        if(keys['a']) dx -= 1;
        if(keys['d']) dx += 1;
        const len = Math.hypot(dx,dy) || 1;
        player.x += (dx/len) * player.speed * dt * 60;
        player.y += (dy/len) * player.speed * dt * 60;
        // clamp
        player.x = clamp(player.x, 10, canvas.width-10);
        player.y = clamp(player.y, 10, canvas.height-10);

        // firing
        player.cooldown -= dt;
        if(mouse.down && player.cooldown <= 0){
          // shoot
          player.cooldown = 1 / player.fireRate;
          const ang = Math.atan2(mouse.y - player.y, mouse.x - player.x);
          shoot(player.x + Math.cos(ang)*player.r, player.y + Math.sin(ang)*player.r, ang);
          beep(1200,0.03,0.02);
        }

        // bullets
        for(let i=bullets.length-1;i>=0;i--){
          const b = bullets[i];
          b.x += b.vx * dt * 60; b.y += b.vy * dt * 60;
          // lifetime
          b.life -= dt;
          if(b.life <=0 || b.x< -50 || b.y< -50 || b.x>canvas.width+50 || b.y>canvas.height+50){ bullets.splice(i,1); continue; }
          // collide with enemies
          for(let j=enemies.length-1;j>=0;j--){
            const e = enemies[j];
            const dist = Math.hypot(e.x-b.x, e.y-b.y);
            if(dist < e.r + 2){
              e.hp -= b.dmg;
              particlesPush(b.x,b.y,4);
              bullets.splice(i,1);
              if(e.hp<=0){
                // enemy dead
                spawnCoin(e.x,e.y, Math.round(e.value));
                createExplosion(e.x,e.y, e.color);
                player.kills += 1; player.score += e.value;
                player.money += Math.round(e.value);
                killsEl.textContent = player.kills;
                beep(400,0.06,0.04);
                enemies.splice(j,1);
              }
              break;
            }
          }
        }

        // enemies move
        for(let i=enemies.length-1;i>=0;i--){
          const e = enemies[i];
          const ang = Math.atan2(player.y - e.y, player.x - e.x);
          e.x += Math.cos(ang) * e.spd * dt * 60;
          e.y += Math.sin(ang) * e.spd * dt * 60;
          // collision with player
          const d = Math.hypot(player.x-e.x, player.y-e.y);
          if(d < e.r + player.r - 4){
            // damage over time
            const dmg = Math.ceil((e.maxHp/20) * dt * 60);
            player.hp -= dmg;
            // push back a bit
            const push = 6;
            player.x -= Math.cos(ang) * push * dt * 60;
            player.y -= Math.sin(ang) * push * dt * 60;
            if(player.hp <=0){
              player.hp = 0; gameOver();
            }
          }
        }

        // update particles
        for(let i=particles.length-1;i>=0;i--){
          const p = particles[i]; p.x += p.vx * dt * 60; p.y += p.vy * dt * 60;
          p.life -= dt; p.alpha = p.life / p.maxLife;
          if(p.life <=0) particles.splice(i,1);
        }

        // coins pickup
        for(let i=coins.length-1;i>=0;i--){
          const c = coins[i]; c.y += Math.sin(Date.now()/300 + i)*0.2; // bob
          const d = Math.hypot(player.x-c.x, player.y-c.y);
          if(d < player.r + 8){ player.money += c.v; coins.splice(i,1); beep(1000,0.05,0.02);} 
        }

        // spawn wave manager
        if(spawning){
          waveTimer += dt;
          if(waveTimer > 0.6 && spawnCount>0){ spawnFromEdge(); spawnCount--; waveTimer=0; }
          if(spawnCount<=0 && enemies.length===0){ spawning=false; setTimeout(startWave,1200); }
        }

        // update HUD
        updateHUD();

        // slowly regen a tiny bit
        player.hp = clamp(player.hp + dt*0.5, 0, player.maxHp);
      }

      function updateHUD(){
        moneyEl.textContent = player.money;
        hpEl.textContent = Math.round(player.hp);
        maxHpEl.textContent = player.maxHp;
        statDamage.textContent = player.damage;
        statFR.textContent = player.fireRate.toFixed(1);
        statSpeed.textContent = player.speed.toFixed(1);
      }

      function shoot(x,y,ang){
        const speed = player.bulletSpeed;
        bullets.push({x:x,y:y,vx:Math.cos(ang)*speed,vy:Math.sin(ang)*speed,dmg:player.damage,life:2});
      }

      function spawnCoin(x,y,v){ coins.push({x:x,y:y,v:v}); }

      function particlesPush(x,y,count){ for(let i=0;i<count;i++){ particles.push({x:x,y:y,vx:rand(-1.6,1.6),vy:rand(-1.6,1.6),life:rand(0.2,0.6),maxLife:0.6,alpha:1}) } }
      function createExplosion(x,y,color){ for(let i=0;i<18;i++){ particles.push({x:x,y:y,vx:rand(-3,3),vy:rand(-3,3),life:rand(0.6,1.2),maxLife:1.2,alpha:1,color:color}) } }

      function gameOver(){ paused=true; setTimeout(()=>{
        const again = confirm('You died! Score: '+player.score+". Restart?"); if(again){ location.reload(); }
      },200);
      }

      // draw loop
      function draw(){
        // background
        ctx.clearRect(0,0,canvas.width,canvas.height);
        // subtle grid
        ctx.save(); ctx.globalAlpha = 0.05; ctx.strokeStyle = '#fff'; for(let gx=0;gx<canvas.width;gx+=40){ ctx.beginPath(); ctx.moveTo(gx,0); ctx.lineTo(gx,canvas.height); ctx.stroke(); } for(let gy=0;gy<canvas.height;gy+=40){ ctx.beginPath(); ctx.moveTo(0,gy); ctx.lineTo(canvas.width,gy); ctx.stroke(); } ctx.restore();

        // draw coins
        for(const c of coins){ ctx.beginPath(); ctx.fillStyle = '#ffd15a'; ctx.arc(c.x,c.y,8,0,Math.PI*2); ctx.fill(); ctx.fillStyle='rgba(0,0,0,0.25)'; ctx.fillRect(c.x-4,c.y-2,8,3); }

        // draw enemies
        for(const e of enemies){
          ctx.beginPath(); ctx.fillStyle = e.color || '#f55'; ctx.arc(e.x,e.y,e.r,0,Math.PI*2); ctx.fill();
          // hp bar
          ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(e.x - e.r, e.y - e.r - 8, e.r*2,6);
          ctx.fillStyle = '#2ee68a'; ctx.fillRect(e.x - e.r, e.y - e.r - 8, (e.hp / e.maxHp) * e.r*2,6);
        }

        // draw bullets
        for(const b of bullets){ ctx.beginPath(); ctx.fillStyle = '#fff'; ctx.arc(b.x,b.y,3,0,Math.PI*2); ctx.fill(); }

        // draw particles
        for(const p of particles){ ctx.beginPath(); ctx.globalAlpha = p.alpha; ctx.fillStyle = p.color || '#fff'; ctx.arc(p.x,p.y,Math.max(1, p.life*3),0,Math.PI*2); ctx.fill(); ctx.globalAlpha = 1; }

        // player aim cone & player
        const ang = Math.atan2(mouse.y-player.y, mouse.x-player.x);
        // muzzle flash
        ctx.save(); ctx.translate(player.x,player.y); ctx.rotate(ang);
        // player body
        ctx.beginPath(); ctx.fillStyle = '#dfe9ff'; ctx.arc(0,0,player.r,0,Math.PI*2); ctx.fill();
        // gun barrel
        ctx.fillStyle = '#111'; ctx.fillRect(8, -4, 16, 8);
        ctx.restore();

        // HUD on canvas center: crosshair
        ctx.beginPath(); ctx.strokeStyle = 'rgba(255,255,255,0.4)'; ctx.moveTo(mouse.x-10,mouse.y); ctx.lineTo(mouse.x+10,mouse.y); ctx.moveTo(mouse.x,mouse.y-10); ctx.lineTo(mouse.x,mouse.y+10); ctx.stroke();

        // minimap-ish player dot
        ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(20, canvas.height-20, 6,0,Math.PI*2); ctx.fill();

        // draw 'wave incoming' text
        if(spawning && enemies.length===0){ ctx.fillStyle='rgba(255,255,255,0.12)'; ctx.font='28px sans-serif'; ctx.fillText('Spawning...', canvas.width/2-60, 60); }
      }

      // Main loop
      function loop(ts){
        const dt = Math.min(0.05, (ts - lastTime) / 1000 || 0.016);
        lastTime = ts;
        if(running){ update(dt); draw(); }
        requestAnimationFrame(loop);
      }

      // start first wave after short delay
      setTimeout(()=>{startWave();},800);
      requestAnimationFrame(loop);

      // make sure UI buttons mapped to costs update DOM on start
      updateHUD();

      // tools for developer tweak
      // expose some for console fun
      window.__game = {player,enemies,bullets,coins,particles,spawnFromEdge,startWave};
    })();
  </script>
</body>
</html>

